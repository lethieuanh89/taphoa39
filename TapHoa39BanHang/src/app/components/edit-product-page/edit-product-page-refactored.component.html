<div class="search-header">
    <!-- <button class="voice-icon" mat-icon-button matPrefix (click)="startVoiceInput()">üé§</button> -->
    <div class="search-wrapper">
    
      <input type="text" class="search-bar" matInput [formControl]="searchControl"
        placeholder="T√¨m ki·∫øm: nh·∫≠p m√£ h√†ng ho·∫∑c t√™n h√†ng v√† g√µ Enter..." (keyup.enter)="onSearch($event)" />
    </div>
  

  <mat-toolbar class="toolbar">
    <button mat-button class="update-button" (click)="onUpdate()">
      <mat-icon>save</mat-icon>
      C·∫≠p nh·∫≠t
    </button>
    <button mat-button class="add-product-button" (click)="addProduct()">
      <mat-icon>add_shopping_cart</mat-icon>
      Th√™m h√†ng h√≥a
    </button>
    <button mat-button class="clear-cache-button" (click)="clearAllCache()" matTooltip="X√≥a to√†n b·ªô d·ªØ li·ªáu t·∫°m">
      <mat-icon>delete_sweep</mat-icon>
      X√≥a cache
    </button>
  </mat-toolbar>

  <div *ngIf="showOfflineHint" class="sync-hint">
    <span class="sync-dot"></span>
    <span>{{ hintMessage }}</span>
  </div>
</div>

<div *ngIf="isLoading" class="loading-overlay">
  <div class="spinner"></div>
  <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
</div>

<!-- Main Product Table -->
<div class="products-container">
  <!-- Sticky Header -->
  <div class="table-header">
    <div class="header-cell expand-col"></div>
    <div class="header-cell checkbox-col" title="T√≠nh trung b√¨nh">TB</div>
    <div class="header-cell image-col">·∫¢nh</div>
    <div class="header-cell code-col">M√£ h√†ng</div>
    <div class="header-cell name-col">T√™n h√†ng</div>
    <div class="header-cell price-col" title="Gi√° b√°n ƒë·ªÅ xu·∫•t">Gi√° b√°n</div>
    <div class="header-cell cost-col">Gi√° v·ªën</div>
    <div class="header-cell onhand-col">T·ªìn kho</div>
    <div class="header-cell unit-col">ƒê∆°n v·ªã</div>
    <div class="header-cell box-col">Th√πng</div>
    <div class="header-cell retail-col">L·∫ª</div>
    <div class="header-cell discount-col" title="Chi·∫øt kh·∫•u / s·∫£n ph·∫©m">Chi·∫øt kh·∫•u/<br>S·∫£n ph·∫©m</div>
    <div class="header-cell discount2-col" title="Chi·∫øt kh·∫•u / t·ªïng ti·ªÅn">Chi·∫øt kh·∫•u/<br>T·ªïng ti·ªÅn</div>
    <div class="header-cell totalprice-col">Th√†nh ti·ªÅn</div>
  </div>

  <!-- Product Rows with Virtual Scrolling -->
  <cdk-virtual-scroll-viewport class="products-viewport" [itemSize]="50" [minBufferPx]="500" [maxBufferPx]="1000">
    <ng-container *cdkVirtualFor="let group of productGroups; trackBy: trackByGroup">
      <app-product-row [product]="group.master" [childProducts]="group.children"
        [productColor]="getProductColor(group.master.Id)"
        (productChange)="onProductChange($event, productGroups.indexOf(group))"
        (childrenChange)="onChildrenChange($event, productGroups.indexOf(group))"></app-product-row>
    </ng-container>
  </cdk-virtual-scroll-viewport>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && productGroups.length === 0">
    <mat-icon class="empty-icon">search_off</mat-icon>
    <h3>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</h3>
    <p>Vui l√≤ng nh·∫≠p m√£ h√†ng ho·∫∑c t√™n h√†ng ƒë·ªÉ t√¨m ki·∫øm</p>
  </div>
</div>
